(function(e){e.address=function(){var t=function(t){var r=e.extend(e.Event(t),function(){var t={},r=e.address.parameterNames();for(var n=0,i=r.length;n<i;n++){t[r[n]]=e.address.parameter(r[n])}return{value:e.address.value(),path:e.address.path(),pathNames:e.address.pathNames(),parameterNames:r,parameters:t,queryString:e.address.queryString()}}.call(e.address));e(e.address).trigger(r);return r},r=function(e){return Array.prototype.slice.call(e)},n=function(t,r,n){e().bind.apply(e(e.address),Array.prototype.slice.call(arguments));return e.address},i=function(t,r){e().unbind.apply(e(e.address),Array.prototype.slice.call(arguments));return e.address},a=function(){return z.pushState&&O.state!==E},s=function(){return("/"+B.pathname.replace(new RegExp(O.state),"")+B.search+(o()?"#"+o():"")).replace(D,"/")},o=function(){var e=B.href.indexOf("#");return e!=-1?B.href.substr(e+1):""},u=function(){return a()?s():o()},c=function(){try{return top.document!==E&&top.document.title!==E&&top.jQuery!==E&&top.jQuery.address!==E&&top.jQuery.address.frames()!==false?top:window}catch(e){return window}},f=function(){return"javascript"},l=function(e){e=e.toString();return(O.strict&&e.substr(0,1)!="/"?"/":"")+e},d=function(e,t){return parseInt(e.css(t),10)},p=function(){if(!Z){var e=u(),t=decodeURI(it)!=decodeURI(e);if(t){if(M&&F<7){B.reload()}else{if(M&&!G&&O.history){Q(v,50)}it=e;h($)}}}},h=function(e){Q(g,10);return t(T).isDefaultPrevented()||t(e?A:q).isDefaultPrevented()},g=function(){if(O.tracker!=="null"&&O.tracker!==S){var t=e.isFunction(O.tracker)?O.tracker:W[O.tracker],r=(B.pathname+B.search+(e.address&&!a()?e.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(e.isFunction(t)){t(r)}else if(e.isFunction(W.urchinTracker)){W.urchinTracker(r)}else if(W.pageTracker!==E&&e.isFunction(W.pageTracker._trackPageview)){W.pageTracker._trackPageview(r)}else if(W._gaq!==E&&e.isFunction(W._gaq.push)){W._gaq.push(["_trackPageview",decodeURI(r)])}}},v=function(){var e=f()+":"+$+";document.open();document.writeln('<html><head><title>"+_.title.replace(/\'/g,"\\'")+"</title><script>var "+I+' = "'+encodeURIComponent(u()).replace(/\'/g,"\\'")+(_.domain!=B.hostname?'";document.domain="'+_.domain:"")+'";</'+"script></head></html>');document.close();";if(F<7){H.src=e}else{H.contentWindow.location.replace(e)}},m=function(){if(V&&X!=-1){var e,t,r=V.substr(X+1).split("&");for(e=0;e<r.length;e++){t=r[e].split("=");if(/^(autoUpdate|history|strict|wrap)$/.test(t[0])){O[t[0]]=isNaN(t[1])?/^(true|yes)$/i.test(t[1]):parseInt(t[1],10)!==0}if(/^(state|tracker)$/.test(t[0])){O[t[0]]=t[1]}}V=S}it=u()},y=function(){if(!et){et=N;m();e('a[rel*="address:"]').address();if(O.wrap){var r=e("body"),n=e("body > *").wrapAll('<div style="padding:'+(d(r,"marginTop")+d(r,"paddingTop"))+"px "+(d(r,"marginRight")+d(r,"paddingRight"))+"px "+(d(r,"marginBottom")+d(r,"paddingBottom"))+"px "+(d(r,"marginLeft")+d(r,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+I+'" style="height:100%;overflow:auto;position:relative;'+(C&&!window.statusbar.visible?"resize:both;":"")+'" />');e("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});if(C){e('<style type="text/css" />').appendTo("head").text("#"+I+"::-webkit-resizer { background-color: #fff; }")}}if(M&&!G){var i=_.getElementsByTagName("frameset")[0];H=_.createElement((i?"":"i")+"frame");H.src=f()+":"+$;if(i){i.insertAdjacentElement("beforeEnd",H);i[i.cols?"cols":"rows"]+=",0";H.noResize=N;H.frameBorder=H.frameSpacing=0}else{H.style.display="none";H.style.width=H.style.height=0;H.tabIndex=-1;_.body.insertAdjacentElement("afterBegin",H)}Q(function(){e(H).bind("load",function(){var e=H.contentWindow;it=e[I]!==E?e[I]:"";if(it!=u()){h($);B.hash=it}});if(H.contentWindow[I]===E){v()}},50)}Q(function(){t("init");h($)},1);if(!a()){if(M&&F>7||!M&&G){if(W.addEventListener){W.addEventListener(j,p,$)}else if(W.attachEvent){W.attachEvent("on"+j,p)}}else{P(p,50)}}if("state"in window.history){e(window).trigger("popstate")}}},w=function(){if(decodeURI(it)!=decodeURI(u())){it=u();h($)}},b=function(){if(W.removeEventListener){W.removeEventListener(j,p,$)}else if(W.detachEvent){W.detachEvent("on"+j,p)}},x=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},k=function(){var e={},t=x(navigator.userAgent);if(t.browser){e[t.browser]=true;e.version=t.version}if(e.chrome){e.webkit=true}else if(e.webkit){e.safari=true}return e},E,S=null,I="jQueryAddress",U="string",j="hashchange",R="init",T="change",A="internalChange",q="externalChange",N=true,$=false,O={autoUpdate:N,history:N,strict:N,frames:N,wrap:$},L=k(),F=parseFloat(L.version),C=L.webkit||L.safari,M=!e.support.opacity,W=c(),_=W.document,z=W.history,B=W.location,P=setInterval,Q=setTimeout,D=/\/{2,9}/g,K=navigator.userAgent,G="on"+j in W,H,J,V=e("script:last").attr("src"),X=V?V.indexOf("?"):-1,Y=_.title,Z=$,et=$,tt=N,rt=$,nt={},it=u();if(M){F=parseFloat(K.substr(K.indexOf("MSIE")+4));if(_.documentMode&&_.documentMode!=F){F=_.documentMode!=8?7:8}var at=_.onpropertychange;_.onpropertychange=function(){if(at){at.call(_)}if(_.title!=Y&&_.title.indexOf("#"+u())!=-1){_.title=Y}}}if(z.navigationMode){z.navigationMode="compatible"}if(document.readyState=="complete"){var st=setInterval(function(){if(e.address){y();clearInterval(st)}},50)}else{m();e(y)}e(window).bind("popstate",w).bind("unload",b);return{bind:function(e,t,i){return n.apply(this,r(arguments))},unbind:function(e,t){return i.apply(this,r(arguments))},init:function(e,t){return n.apply(this,[R].concat(r(arguments)))},change:function(e,t){return n.apply(this,[T].concat(r(arguments)))},internalChange:function(e,t){return n.apply(this,[A].concat(r(arguments)))},externalChange:function(e,t){return n.apply(this,[q].concat(r(arguments)))},baseURL:function(){var e=B.href;if(e.indexOf("#")!=-1){e=e.substr(0,e.indexOf("#"))}if(/\/$/.test(e)){e=e.substr(0,e.length-1)}return e},autoUpdate:function(e){if(e!==E){O.autoUpdate=e;return this}return O.autoUpdate},history:function(e){if(e!==E){O.history=e;return this}return O.history},state:function(e){if(e!==E){O.state=e;var t=s();if(O.state!==E){if(z.pushState){if(t.substr(0,3)=="/#/"){B.replace(O.state.replace(/^\/$/,"")+t.substr(2))}}else if(t!="/"&&t.replace(/^\/#/,"")!=o()){Q(function(){B.replace(O.state.replace(/^\/$/,"")+"/#"+t)},1)}}return this}return O.state},frames:function(e){if(e!==E){O.frames=e;W=c();return this}return O.frames},strict:function(e){if(e!==E){O.strict=e;return this}return O.strict},tracker:function(e){if(e!==E){O.tracker=e;return this}return O.tracker},wrap:function(e){if(e!==E){O.wrap=e;return this}return O.wrap},update:function(){rt=N;this.value(it);rt=$;return this},title:function(e){if(e!==E){Q(function(){Y=_.title=e;if(tt&&H&&H.contentWindow&&H.contentWindow.document){H.contentWindow.document.title=e;tt=$}},50);return this}return _.title},value:function(e){if(e!==E){e=l(e);if(e=="/"){e=""}if(it==e&&!rt){return}it=e;if(O.autoUpdate||rt){if(h(N)){return this}if(a()){z[O.history?"pushState":"replaceState"]({},"",O.state.replace(/\/$/,"")+(it===""?"/":it))}else{Z=N;if(C){if(O.history){B.hash="#"+it}else{B.replace("#"+it)}}else if(it!=u()){if(O.history){B.hash="#"+it}else{B.replace("#"+it)}}if(M&&!G&&O.history){Q(v,50)}if(C){Q(function(){Z=$},1)}else{Z=$}}}return this}return l(it)},path:function(e){if(e!==E){var t=this.queryString(),r=this.hash();this.value(e+(t?"?"+t:"")+(r?"#"+r:""));return this}return l(it).split("#")[0].split("?")[0]},pathNames:function(){var e=this.path(),t=e.replace(D,"/").split("/");if(e.substr(0,1)=="/"||e.length===0){t.splice(0,1)}if(e.substr(e.length-1,1)=="/"){t.splice(t.length-1,1)}return t},queryString:function(e){if(e!==E){var t=this.hash();this.value(this.path()+(e?"?"+e:"")+(t?"#"+t:""));return this}var r=it.split("?");return r.slice(1,r.length).join("?").split("#")[0]},parameter:function(t,r,n){var i,a;if(r!==E){var s=this.parameterNames();a=[];r=r===E||r===S?"":r.toString();for(i=0;i<s.length;i++){var o=s[i],u=this.parameter(o);if(typeof u==U){u=[u]}if(o==t){u=r===S||r===""?[]:n?u.concat([r]):[r]}for(var c=0;c<u.length;c++){a.push(o+"="+u[c])}}if(e.inArray(t,s)==-1&&r!==S&&r!==""){a.push(t+"="+r)}this.queryString(a.join("&"));return this}r=this.queryString();if(r){var f=[];a=r.split("&");for(i=0;i<a.length;i++){var l=a[i].split("=");if(l[0]==t){f.push(l.slice(1).join("="))}}if(f.length!==0){return f.length!=1?f:f[0]}}},parameterNames:function(){var t=this.queryString(),r=[];if(t&&t.indexOf("=")!=-1){var n=t.split("&");for(var i=0;i<n.length;i++){var a=n[i].split("=")[0];if(e.inArray(a,r)==-1){r.push(a)}}}return r},hash:function(e){if(e!==E){this.value(it.split("#")[0]+(e?"#"+e:""));return this}var t=it.split("#");return t.slice(1,t.length).join("#")}}}();e.fn.address=function(t){e(this).each(function(r){if(!e(this).data("address")){e(this).on("click",function(r){if(r.shiftKey||r.ctrlKey||r.metaKey||r.which==2){return true}var n=r.currentTarget;if(e(n).is("a")){r.preventDefault();var i=t?t.call(n):/address:/.test(e(n).attr("rel"))?e(n).attr("rel").split("address:")[1].split(" ")[0]:e.address.state()!==undefined&&!/^\/?$/.test(e.address.state())?e(n).attr("href").replace(new RegExp("^(.*"+e.address.state()+"|\\.)"),""):e(n).attr("href").replace(/^(#\!?|\.)/,"");e.address.value(i)}}).on("submit",function(r){var n=r.currentTarget;if(e(n).is("form")){r.preventDefault();var i=e(n).attr("action"),a=t?t.call(n):(i.indexOf("?")!=-1?i.replace(/&$/,""):i+"?")+e(n).serialize();e.address.value(a)}}).data("address",true)}});return this}})(jQuery);